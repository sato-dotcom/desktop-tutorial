@tailwind base;
@tailwind components;
@tailwind utilities;

/* Basic layout */
html, body {
  @apply m-0 p-0 h-full overflow-hidden font-sans;
}

#map {
  @apply fixed inset-0 w-screen bg-gray-400;
  height: 100vh; /* Fallback */
  height: 100dvh;
}

/* Add this for performance */
.leaflet-map-pane {
    will-change: transform;
}


/* --- Custom Leaflet Controls --- */
.leaflet-control-custom-btn {
  @apply w-[34px] h-[34px] flex items-center justify-center text-lg cursor-pointer transition-colors duration-200;
  line-height: 34px;
}

/* --- 【★修正】 追従ボタンの状態に応じたスタイル --- */
/* aタグへの限定を外し、直接クラスに適用して優先度を上げる */

/* 追従オン (is-on): 青背景 + 白文字 */
.leaflet-control-custom-btn.is-on {
  @apply bg-blue-500 text-white !important;
}
.leaflet-control-custom-btn.is-on:hover {
  @apply bg-blue-600 text-white !important;
}

/* 追従オフ (is-off): 白背景 + 黒文字 */
.leaflet-control-custom-btn.is-off {
  @apply bg-white text-gray-800 !important;
}
.leaflet-control-custom-btn.is-off:hover {
  @apply bg-gray-100 text-gray-800 !important;
}


/* --- User Marker --- */

/* [修正] Leafletが生成するマーカーのコンテナ(#userMarker)に対して、
  flexboxを用いて内部要素を完全に中央揃えにするスタイルを適用。
  セレクタを実際のDOM構造に合わせ、!importantでLeafletのスタイルを上書きます。
*/
#userMarker.user-marker {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 30px !important;
  height: 30px !important;
  line-height: 30px !important;
  vertical-align: middle !important;
}

/* [修正] マーカーの回転を担当する内部コンテナ(.user-location-marker-rotator)にも
  同様のスタイルを適用し、transformの基点と描画最適化を追加します。
*/
#userMarker .user-location-marker-rotator {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 30px !important;
  height: 30px !important;
  line-height: 30px !important;
  vertical-align: middle !important;
  transform-origin: center center;
  will-change: transform;
}

/* [修正] SVGアイコン自体のスタイルをリセットし、Tailwindのスタイルを適用。
  これにより、意図しない余白やズレを防ぎます。
*/
#userMarker .user-location-marker-rotator svg {
  @apply w-full h-full fill-current text-blue-500;
  filter: drop-shadow(0 0 3px rgba(0,0,0,0.5));
  display: block !important;
  line-height: normal !important;
  vertical-align: middle !important;
}


/* --- Controls Panel --- */
#controls-panel {
    @apply fixed bottom-0 left-0 right-0 max-h-[60%] transition-transform duration-300 ease-in-out;
    transform: translateY(0);
}

/* --- Fullscreen Mode --- */
body.fullscreen-active #controls-panel {
    transform: translateY(100%);
}
body.fullscreen-active #fullscreen-info-panel {
    @apply opacity-100;
}
#fullscreen-info-panel {
    @apply fixed top-4 left-4 bg-white bg-opacity-80 p-3 rounded-lg shadow-lg pointer-events-none opacity-0 transition-opacity;
    backdrop-filter: blur(5px);
}

/* --- Mode Display & Control --- */
#mode-display {
    @apply fixed top-4 right-4 bg-white bg-opacity-80 p-2 rounded-lg shadow-lg font-bold text-blue-600 pointer-events-none;
    z-index: 1000;
    backdrop-filter: blur(5px);
}
.leaflet-control-mode {
    @apply flex items-center p-1;
}
.leaflet-control-mode select {
    @apply text-xs border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500;
}


/* --- Modals --- */
.modal {
    @apply hidden;
}
.modal.is-open {
    @apply flex;
}

/* --- Scrollbar --- */
.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
}
.custom-scrollbar::-webkit-scrollbar-track {
  @apply bg-gray-100;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
  @apply bg-gray-400 rounded-full;
}

/* Spinner for AI button */
.spinner {
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

/* --- Debug Panel --- */
.debug-panel {
    @apply fixed right-2 bottom-2 bg-black bg-opacity-70 text-white font-mono text-xs p-2 rounded-md shadow-lg pointer-events-none;
    z-index: 9999;
    max-height: 40vh;
    overflow-y: auto;
    white-space: pre;
}