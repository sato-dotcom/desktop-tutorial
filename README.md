# 海洋版測量支援アプリ「うみねこ」README

## 概要

現場での測量作業を効率化するためのブラウザベースの支援ツール。複数のAIとの協働により、技術検証・改善・記録を継続的に行っています。

Copilot Pagesを用いて修正履歴や技術検証ログを記録・整理しています。

## プロジェクト概要

- **目的**：海上・沿岸部での測量作業を支援する軽量・実用的なWebアプリの開発  
- **対象ユーザー**：現場の測量技術者、調査員、施工管理者  
- **特徴**：
  - ブラウザで動作（インストール不要）
  - 地図表示・現在地マーカー・全画面切替対応
  - Heading-up表示の実装を検討中

## 技術スタック

| 技術         | 用途               |
|--------------|--------------------|
| HTML / CSS / JavaScript | フロントエンド       |
| [Leaflet.js](https://Leaflet.js) | 地図表示と現在地マーカー |
| GitHub Pages | ホスティング       |
| AIツール（Copilot, Gemini） | 技術検証・コードレビュー・改善提案 |

## セットアップ手順

1. このリポジトリをクローン  
   ```bash
   git clone https://github.com/sato-dotcom/desktop-tutorial

2. index.html をブラウザで開く

3. モバイル端末でも動作確認可能（Chrome推奨）


## 技術検証ログ（別ファイル）

- `map.once('resize')` によるマーカー再描画のタイミング調整  
- `requestAnimationFrame` を用いた描画安定化の試行  
- `updateMapView(true)` によるマーカー位置補正の効果検証  

## TODO / 今後の課題

- Heading-up表示の安定化とUI調整  
- モバイル端末での動作検証（GPS精度・画面サイズ対応）  
- 地図切替時のマーカーズレ防止  
- フィールドテストによる実用性評価  

## 開発の経緯（別ファイル）

### 背景・経緯（2025年9月3日）

ブラウザベースの測量支援アプリ（Leaflet使用）にて、全画面表示切替後に現在地マーカーが中央に配置されない問題が発生。追従モードや地図の向き（ノースアップ／ヘディングアップ）との組み合わせで挙動が不安定になる。

屋内外でテスト済み。全画面ONにしても、OFF時の中央位置にマーカーが残る。

### 試したこと（技術的アプローチの記録）

- `requestAnimationFrame` / `setTimeout` → 効果なし  
- `map.once('resize', ...)` → 効果なし  
- `container.offsetWidth` で強制リフロー → 効果なし  
- `updateMapView(true)` → 意図通り動かず  
- `panBy` でピクセル補正 → 稀に成功するが安定せず  
- GPS更新とUIイベントをフラグで連携 → 結果変わらず  
- resize イベント完了後に `updateMapView` → 期待通りに動かない  

### 現状と期待する挙動（2025年9月3日）

- 全画面切替直後に現在地が中央に配置されない  
- 室内・屋外で同様の挙動  
- 期待する挙動：全画面切替後、追従モードONなら現在地がマップ中央に配置されること  

## AI連携履歴（別ファイル）
# うみねこ 開発ドキュメント（ファイル役割 × 修正履歴 × 担当）

## 1. ファイル構成と役割
| ファイル / フォルダ | 種別 | 主な役割・機能 | 記述内容の概要 |
|---|---|---|---|
| dist/ | フォルダ | ビルド後の成果物 | Node.jsやビルドツールで生成された、ブラウザ配信用の最終ファイル群 |
| src/ | フォルダ | ソースコード格納 | 開発用の元ファイル（CSS, JS, 画像など） |
| Node.js_README.md | ドキュメント | Node.js環境説明 | Node.jsのセットアップ方法、ビルド・実行手順 |
| README.md | ドキュメント | プロジェクト概要 | アプリの目的、機能一覧、使用方法など |
| api.js | JS | API通信処理 | 外部APIとの通信処理やデータ取得関数 |
| data.js | JS | データ管理 | 測点や設定値などのデータ構造や初期値 |
| gps.js | JS | GPS制御 | 位置情報・方位センサーの取得処理 |
| index.html | HTML | エントリーポイント | 画面構造とCSS/JSの読み込み設定 |
| main.js | JS | アプリ初期化・制御 | 起動処理、イベント設定、モード切替 |
| map.js | JS | 地図描画制御 | Leaflet.jsによる地図生成とマーカー描画 |
| mapController.js | JS | 地図操作ロジック集約 | 全画面切替後の再描画、マーカー位置補正、回転制御 |
| package-lock.json | JSON | 依存関係固定 | npmパッケージのバージョン固定情報 |
| package.json | JSON | プロジェクト設定 | プロジェクト名、依存パッケージ、ビルド/実行スクリプト |
| state.js | JS | 状態管理 | 現在地、モード、測点データなどの状態保持 |
| style.css | CSS | スタイル定義 | UIの見た目（色、レイアウト、フォントなど） |
| tailwind.config.js | JS設定 | TailwindCSS設定 | カスタムテーマやブレークポイント設定 |
| ui.js | JS | UI操作 | ボタンやメニューの表示切替、画面更新処理 |

## 2. 役割分担（AI連携）
| 役割 | 担当 | 主な作業 |
|---|---|---|
| 開発者・ユーザー | Akinori | 実験環境構築、テスト結果記録、期待挙動定義 |
| 技術顧問 | GPT‑5（ChatGPT） | 設計レビュー、ロジック検証、技術的分析 |
| 開発ディレクター | Copilot | 課題整理、進行管理、Geminiへの指示文作成 |
| 実装エンジニア | Gemini | コード修正、ビルド、動作確認 |

## 3. 利用方法（AI連携時）
1. 私のコメント：テスト条件・結果・気づきを記録  
2. GPT‑5のレビュー：技術的分析  
3. Copilotのレビュー：UI/UX視点の分析  
4. Geminiへの要望文：修正指示を明文化  
5. 修正版をGitHubに反映 → Netlifyで自動デプロイ → 再テスト

## 4. 修正履歴と関連ファイル
| 日付       | AI      | 内容                                                   |
|------------|---------|--------------------------------------------------------|
| 2025/09/01 | Copilot | Leafletのresizeイベントに関する検討と提案             |
| 2025/09/02 | Gemini  | マーカー位置ズレの修正案をIssue #1に記録              |
| 2025/09/03 | Copilot | READMEテンプレートの設計と構成支援                    |
| 2025/09/05 | Gemini  | 全画面切替後のマーカー再配置に関するコード修正        |
| 2025/09/08-(1) | Gemini  | 全画面表示・コンパス挙動・イベント処理の安定化       |
| 2025/09/08-(2) | Gemini  | マーカー中央固定・イベントバインド・TailwindCSS対応  |

| 日付 | 修正内容 | 関連ファイル | 担当 |
|---|---|---|---|
| 2025/09/08-(3) | Node.js環境導入、ビルド構成整理、容量削減（.gitignore/圧縮） | package.json, package-lock.json, tailwind.config.js, src/, dist/, README.md, index.html | Gemini |
| 2025/09/08-(4) | 構文エラー修正、参照エラー解消、地図初期化正常化 | state.js, ui.js, api.js, map.js | Gemini |
| 2025/09/09 | 全画面表示時のマーカー位置ズレ・コンパス挙動改善（部分） | mapController.js, gps.js, main.js | Gemini（要追加修正） |
